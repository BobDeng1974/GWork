# Gwork Travis config

# Life cycle: (https://docs.travis-ci.com/user/customizing-the-build/)
#
#   - OPTIONAL Install apt addons
#   - OPTIONAL Install cache components
#   - before_install
#   - install
#   - before_script
#   - script
#   - OPTIONAL before_cache (for cleaning up cache)
#   - after_success or after_failure
#   - OPTIONAL before_deploy
#   - OPTIONAL deploy
#   - OPTIONAL after_deploy
#   - after_script


# Use Ubuntu Trusty (14) for mostly up-to-date packages
sudo: required
dist: trusty
language: cpp

# Travis compilers are out of date if we want to use modern C++1y features. Need to
# explicitly specify external packages required and versions in matrix.
# Problems for earlier compilers include <codecvt> coverage on GCC.
#
# More info: http://genbattle.bitbucket.org/blog/2016/01/17/c++-travis-ci/
# matrix example: https://github.com/ColinH/PEGTL/blob/master/.travis.yml
#
# currently issue for adding the Trusty LLVM ppa to Travisâ€™ whitelist, previous, 12.04
# issue: https://github.com/travis-ci/apt-source-whitelist/pull/205

# Linux packages are got using apt on Travis.
# See: https://docs.travis-ci.com/user/installing-dependencies/
#
# matrix:
#   include:
#     - os: linux
#       compiler: gcc
#       addons:
#         apt:
#           sources:
#             - ubuntu-toolchain-r-test
#           packages:
#             - g++-4.9
#       env: COMPILER=g++-4.9
#
#     - os: linux
#       compiler: gcc
#       addons:
#         apt:
#           sources:
#             - ubuntu-toolchain-r-test
#           packages:
#             - g++-5
#       env: COMPILER=g++-5
#
#     - os: linux
#       compiler: gcc
#       addons:
#         apt:
#           sources:
#             - ubuntu-toolchain-r-test
#           packages:
#             - g++-6
#       env: COMPILER=g++-6
#
#     - os: linux
#       compiler: gcc
#       addons:
#         apt:
#           sources:
#             - ubuntu-toolchain-r-test
#           packages:
#             - g++-7
#       env: COMPILER=g++-7
#
#     - os: linux
#       compiler: clang
#       addons:
#         apt:
#           sources:
#             - ubuntu-toolchain-r-test
#             - llvm-toolchain-trusty-3.6
#           packages:
#             - clang-3.6
#       env: COMPILER=clang++-3.6
#
#     - os: linux
#       compiler: clang
#       addons:
#         apt:
#           sources:
#             - ubuntu-toolchain-r-test
#             - llvm-toolchain-trusty-3.7
#           packages:
#             - clang-3.7
#       env: COMPILER=clang++-3.7
#
#     - os: linux
#       compiler: clang
#       addons:
#         apt:
#           sources:
#             - ubuntu-toolchain-r-test
#             - llvm-toolchain-trusty-3.8
#           packages:
#             - clang-3.8
#       env: COMPILER=clang++-3.8
#
#     - os: linux
#       compiler: clang
#       addons:
#         apt:
#           sources:
#             - ubuntu-toolchain-r-test
#             - llvm-toolchain-trusty-4.0
#           packages:
#             - clang-4.0
#       env: COMPILER=clang++-4.0
#
#     - os: linux
#       compiler: clang
#       addons:
#         apt:
#           sources:
#             - ubuntu-toolchain-r-test
#             - llvm-toolchain-precise-5.0
#           packages:
#             - clang-5.0
#       env: COMPILER=clang++-5.0
#
#     - os: osx               # Xcode (previous)
#       osx_image: xcode8.2
#       compiler: clang
#       env: COMPILER=clang++
#       install: ./ci/travis/install.sh "+ponder +lua"
#
#     - os: osx               # Xcode (latest)
#       osx_image: xcode9.1
#       compiler: clang
#       env: COMPILER=clang++
#       install: ./ci/travis/install.sh "+ponder +lua"

os:
  - linux
  - osx

# On OSX, the version of clang is controlled by the choice of osx_image.
compiler:
  - gcc
  - clang
  
env:
  - INSTALL="+lua" FEATURES="-DWANT_REFLECTION=ON" COMPILER=clang
  - INSTALL="" FEATURES="-DWANT_REFLECTION=OFF" COMPILER=clang
    
before_install: ./ci/travis/install.sh "$INSTALL"
        
script: ./ci/travis/build.sh $COMPILER "$FEATURES"
    
notifications:
  email:
    on_failure: change
    on_success: change
